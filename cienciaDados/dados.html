<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Avan√ßado - An√°lise Musical Spotify</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="container mx-auto bg-white shadow-lg rounded-lg p-6">
        <h1 class="text-3xl font-bold text-center mb-8 text-green-600">Dashboard Avan√ßado de An√°lise Musical 2023</h1>
        
        <!-- Filtros Interativos Expandidos -->
        <div class="mb-6 grid grid-cols-3 gap-4">
            <select id="generoFilter" class="p-2 border rounded">
                <option value="">Todos G√™neros</option>
                <option value="Pop">Pop</option>
                <option value="Country">Country</option>
                <option value="Hip Hop">Hip Hop</option>
            </select>

            <select id="periodoFilter" class="p-2 border rounded">
                <option value="">Todos Per√≠odos</option>
                <option value="2022">2022</option>
                <option value="2023">2023</option>
            </select>

            <select id="artistaFilter" class="p-2 border rounded">
                <option value="">Todos Artistas</option>
                <option value="Miley Cyrus">Miley Cyrus</option>
                <option value="Morgan Wallen">Morgan Wallen</option>
                <option value="Taylor Swift">Taylor Swift</option>
            </select>
        </div>

        <!-- Bot√£o de Filtro Adicionado AQUI -->
        <div class="text-center mb-4">
            <button id="aplicarFiltro" class="bg-green-500 text-white px-4 py-2 rounded">
                Aplicar Filtros
            </button>
        </div>

        <div class="grid grid-cols-2 gap-6">
            <div class="bg-gray-50 p-4 rounded-lg">
                <h2 class="text-xl font-semibold mb-4">Top 5 M√∫sicas por Streams</h2>
                <canvas id="topMusicasChart"></canvas>
            </div>

            <div class="bg-gray-50 p-4 rounded-lg">
                <h2 class="text-xl font-semibold mb-4">Distribui√ß√£o de G√™neros</h2>
                <canvas id="generosChart"></canvas>
            </div>

            <div class="bg-gray-50 p-4 rounded-lg">
                <h2 class="text-xl font-semibold mb-4">Streams Mensais Comparativo</h2>
                <canvas id="streamsTempoChart"></canvas>
            </div>

            <div class="bg-gray-50 p-4 rounded-lg">
                <h2 class="text-xl font-semibold mb-4">Streams vs Dan√ßabilidade</h2>
                <canvas id="streamssDancabilidadeChart"></canvas>
            </div>
        </div>

        <!-- Nova Se√ß√£o de Insights -->
        <div class="mt-8 bg-blue-50 p-6 rounded-lg">
            <h3 class="text-2xl font-bold mb-4 text-blue-700">üîç Insights Estrat√©gicos</h3>
            <div id="insightsContainer" class="grid grid-cols-3 gap-4">
                <div class="bg-white p-4 rounded shadow">
                    <h4 class="font-semibold text-lg mb-2">Tend√™ncia Geral</h4>
                    <p id="tendenciaGeral" class="text-gray-600"></p>
                </div>
                <div class="bg-white p-4 rounded shadow">
                    <h4 class="font-semibold text-lg mb-2">G√™nero Dominante</h4>
                    <p id="generoDominante" class="text-gray-600"></p>
                </div>
                <div class="bg-white p-4 rounded shadow">
                    <h4 class="font-semibold text-lg mb-2">Crescimento de Streams</h4>
                    <p id="crescimentoStreams" class="text-gray-600"></p>
                </div>
            </div>
        </div>

        <div class="mt-6 text-center">
            <button id="exportarDados" class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600 transition">
                üóÇÔ∏è Exportar Dados
            </button>
        </div>
    </div>

    <script>
        // Dados completos (expandidos)
        const dadosCompletos = {
            todasMusicas: [
                { nome: 'Flowers', artista: 'Miley Cyrus', genero: 'Pop', streams: 1200, dancabilidade: 82, ano: 2023 },
                { nome: 'Last Night', artista: 'Morgan Wallen', genero: 'Country', streams: 950, dancabilidade: 65, ano: 2023 },
                { nome: 'Anti-Hero', artista: 'Taylor Swift', genero: 'Pop', streams: 850, dancabilidade: 80, ano: 2022 },
                { nome: 'Rich Flex', artista: 'Drake', genero: 'Hip Hop', streams: 820, dancabilidade: 85, ano: 2022 },
                { nome: 'As It Was', artista: 'Harry Styles', genero: 'Pop', streams: 780, dancabilidade: 75, ano: 2022 }
            ]
        };

        // Vari√°veis globais para os gr√°ficos
        let topMusicasChart, generosChart, streamsTempoChart, streamsDancabilidadeChart;

        // Fun√ß√£o para filtrar dados com mais op√ß√µes
        function filtrarDados() {
            const generoSelecionado = document.getElementById('generoFilter').value;
            const periodoSelecionado = document.getElementById('periodoFilter').value;
            const artistaSelecionado = document.getElementById('artistaFilter').value;

            const dadosFiltrados = dadosCompletos.todasMusicas.filter(musica => 
                (generoSelecionado === '' || musica.genero === generoSelecionado) &&
                (periodoSelecionado === '' || musica.ano.toString() === periodoSelecionado) &&
                (artistaSelecionado === '' || musica.artista === artistaSelecionado)
            );

            atualizarGraficos(dadosFiltrados);
            gerarInsights(dadosFiltrados);
        }

        // Fun√ß√£o para atualizar gr√°ficos
        function atualizarGraficos(dados) {
            // Top M√∫sicas
            topMusicasChart.data.labels = dados.map(m => m.nome);
            topMusicasChart.data.datasets[0].data = dados.map(m => m.streams);
            topMusicasChart.update();

            // G√™neros
            const generosAgrupados = dados.reduce((acc, musica) => {
                acc[musica.genero] = (acc[musica.genero] || 0) + 1;
                return acc;
            }, {});

            generosChart.data.labels = Object.keys(generosAgrupados);
            generosChart.data.datasets[0].data = Object.values(generosAgrupados);
            generosChart.update();

            // Streams Tempo (simplificado)
            streamsTempoChart.data.labels = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'];
            streamsTempoChart.data.datasets[0].data = dados.map(m => m.streams);
            streamsTempoChart.update();

            // Streams vs Dan√ßabilidade
            streamsDancabilidadeChart.data.labels = dados.map(m => m.nome);
            streamsDancabilidadeChart.data.datasets[0].data = dados.map(m => m.streams);
            streamsDancabilidadeChart.data.datasets[1].data = dados.map(m => m.dancabilidade);
            streamsDancabilidadeChart.update();
        }

        // Fun√ß√£o para gerar insights estrat√©gicos
        function gerarInsights(dados) {
            const totalStreams = dados.reduce((sum, musica) => sum + musica.streams, 0);
            const generosContagem = dados.reduce((acc, musica) => {
                acc[musica.genero] = (acc[musica.genero] || 0) + 1;
                return acc;
            }, {});

            const generoDominante = Object.keys(generosContagem).reduce((a, b) => 
                generosContagem[a] > generosContagem[b] ? a : b
            );

            document.getElementById('tendenciaGeral').textContent = 
                `Total de Streams: ${totalStreams} milh√µes`;
            
            document.getElementById('generoDominante').textContent = 
                `G√™nero L√≠der: ${generoDominante}`;
            
            document.getElementById('crescimentoStreams').textContent = 
                `Varia√ß√£o de Streams: +${(totalStreams / dadosCompletos.todasMusicas.length).toFixed(2)}%`;
        }

        // Fun√ß√£o para exportar dados
        function exportarDados() {
            const dadosCSV = dadosCompletos.todasMusicas.map(musica => 
                `${musica.nome},${musica.artista},${musica.genero},${musica.streams},${musica.dancabilidade},${musica.ano}`
            ).join('\n');
            
            const blob = new Blob([`Nome,Artista,G√™nero,Streams,Dan√ßabilidade,Ano\n${dadosCSV}`], { type: 'text/csv' });
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = 'dados_spotify_analytics.csv';
            link.click();
        }

        // Inicializa√ß√£o dos gr√°ficos
        document.addEventListener('DOMContentLoaded', () => {
            // Verifica√ß√£o de exist√™ncia dos elementos
            const aplicarFiltroBtn = document.getElementById('aplicarFiltro');
            const exportarDadosBtn = document.getElementById('exportarDados');

            // Inicializa√ß√£o dos gr√°ficos
            topMusicasChart = new Chart(document.getElementById('topMusicasChart'), {
                type: 'bar',
                data: {
                    labels: dadosCompletos.todasMusicas.map(m => m.nome),
                    datasets: [{
                        label: 'Streams (milh√µes)',
                        data: dadosCompletos.todasMusicas.map(m => m.streams),
                        backgroundColor: 'rgba(75, 192, 192, 0.6)'
                    }]
                }
            });

            generosChart = new Chart(document.getElementById('generosChart'), {
                type: 'pie',
                data: {
                    labels: ['Pop', 'Country', 'Hip Hop'],
                    datasets: [{
                        data: [3, 1, 1],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.6)',
                            'rgba(54, 162, 235, 0.6)',
                            'rgba(255, 206, 86, 0.6)'
                        ]
                    }]
                }
            });

            streamsTempoChart = new Chart(document.getElementById('streamsTempoChart'), {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                    datasets: [{
                        label: 'Streams (milh√µes)',
                        data: dadosCompletos.todasMusicas.map(m => m.streams),
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)'
                    }]
                }
            });

            streamsDancabilidadeChart = new Chart(document.getElementById('streamssDancabilidadeChart'), {
                type: 'bar',
                data: {
                    labels: dadosCompletos.todasMusicas.map(m => m.nome),
                    datasets: [
                        {
                            label: 'Streams (milh√µes)',
                            data: dadosCompletos.todasMusicas.map(m => m.streams),
                            backgroundColor: 'rgba(75, 192, 192, 0.6)'
                        },
                        {
                            label: 'Dan√ßabilidade',
                            data: dadosCompletos.todasMusicas.map(m => m.dancabilidade),
                            type: 'line',
                            borderColor: 'rgba(255, 99, 132, 1)'
                        }
                    ]
                }
            });

            // Adicionar eventos com verifica√ß√£o
            if (aplicarFiltroBtn) {
                aplicarFiltroBtn.addEventListener('click', filtrarDados);
            } else {
                console.error('Bot√£o de filtro n√£o encontrado');
            }

            if (exportarDadosBtn) {
                exportarDadosBtn.addEventListener('click', exportarDados);
            } else {
                console.error('Bot√£o de exporta√ß√£o n√£o encontrado');
            }

            // Gerar insights iniciais
            gerarInsights(dadosCompletos.todasMusicas);
        });
    </script>
</body>
</html>